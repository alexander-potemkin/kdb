
<!DOCTYPE html>
<html>
<head>
  
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <title>CloudRon (managed apps) &mdash; My KDB</title>

    <link rel="shortcut icon" href="../../img/favicon.ico">
    <link rel="stylesheet" href="../../css/alabaster.css" type="text/css">
    <link rel="stylesheet" href="../../css/alabaster-overrides.css" type="text/css">

    

    
      <script src="../../search/main.js"></script>
    

    

    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

    
  
</head>
<body>

  <div class="document">
    <div class="documentwrapper">
      <div class="bodywrapper">
        <div class="body" role="main">
          
            <h3 id="to-get-embedded-turn-credentials">To get embedded turn credentials</h3>
<p><code>env | grep CLOUDRON_TURN</code> inside TURN enabled app, as per this <a href="https://forum.cloudron.io/topic/2467/how-to-use-cloudron-s-coturn-server-with-non-cloudron-apps">forum thread</a>. </p>
<h3 id="install">Install</h3>
<pre><code class="language-bash">wget https://cloudron.io/cloudron-setup --no-check-certificate &amp;&amp; chmod +x ./cloudron-setup &amp;&amp; sudo ./cloudron-setup
</code></pre>
<p>It will take some time (10-30 minutes, depending on the server speed).</p>
<p>Then process to the <a href="https://server_ip">https://server_ip</a> for further web based setup (in Chrome type <code>thisisunsafe</code> to proceed through SSL certificate warning).</p>
<h3 id="for-manual-dns-management">For manual DNS management</h3>
<p>Manual DNS management is not a problem - <strong>use wildcard</strong>  - it requires 3 things to do/consider:</p>
<ol>
<li>Create A type record for * and for <a href="http://hostname.domain.com">hostname.domain.com</a> to IP address, which usually requires hostname ⇒ IP address type record (without domain.com)</li>
<li>Creating same kind of record with <code>my</code> at the beggining: <code>my.hostname</code> ⇒ IP address</li>
<li>Direct A record for every app that is installed (the app will give a hint)</li>
</ol>
<h2 id="mail-setup">Mail setup</h2>
<p>E-mail relay is required to deliver mails to Google &amp; Microsoft. From the <a href="https://forum.cloudron.io/topic/5268/e-mail-relay-service-recommendation/2">forum threads</a> it seems, that <a href="https://elasticemail.com/email-api-pricing">ElasticMail</a> and <a href="https://postmarkapp.com/pricing">PostMark</a> are the best options. Both configured via <a href="https://docs.cloudron.io/email/#relay-outbound-mails">Web UI</a> for e-mail relay.</p>
<h2 id="change-linked-account-for-the-instance">Change linked account for the instance</h2>
<p>As per <a href="https://docs.cloudron.io/appstore/#change-associated-account">the doc</a>.</p>
<p>ssh to the server, execute:</p>
<pre><code class="language-bash">mysql -uroot -ppassword -e &quot;DELETE FROM box.settings WHERE name='cloudron_token';&quot;
</code></pre>
<p>Then login to the AppStore under the account, that needs to be linked. That's it.</p>
<h1 id="automated-https-certificated-update">Automated HTTPS certificated update</h1>
<p>As per this <a href="https://forum.cloudron.io/topic/5648/update-domain-names-with-the-cli-yet-another-topic/11">forum thread</a>.</p>
<pre><code class="language-bash">#!/bin/bash
dns_host_name='domain.com'
token='' #get it from profile page

set +e
set +x

sudo netstat -nr 
sudo route add default gw `sipcalc -I ens3 -i | grep &quot;Usable range&quot; | cut -d &quot;-&quot; -f 2 | xargs` ens3
sudo route del default gw 192.168.168.1 ens4
sudo netstat -nr

curl -k -X POST -H 'Content-Type: application/json' -H &quot;authorization: Bearer $token&quot; --data '{}' https://$dns_host_name/api/v1/cloudron/renew_certs
echo &quot;You can check the status of the task at https://$dns_host_name/logs.html?taskId=$task_id_from_above&quot;
sleep 180

sudo route add default gw 192.168.168.1 ens4
sudo route del default gw `sipcalc -I ens3 -i | grep &quot;Usable range&quot; | cut -d &quot;-&quot; -f 2 | xargs` ens3
sudo netstat -nr
</code></pre>
<p>Could add it to the cron monitoring</p>
<pre><code class="language-bash">@weekly https_certs_update.sh &gt;&gt; https_certs_update.log 2&gt;&amp;1
</code></pre>
<h3 id="troubleshooting">Troubleshooting</h3>
<p>Login failures are in the dovecot logs. You can see "/run/dovecot/dovecot.log" in the mail container (docker exec -ti mail /bin/bash). This is currently not exposed in the Cloudron dashboard. In any case, it will only report if login worked or not, it will hard to make out why it failed.</p>
<h3 id="remove-2fa-for-admin-user">Remove 2FA for admin user</h3>
<p>As per the <a href="https://forum.cloudron.io/topic/5794/how-to-reset-2fa-for-admin">doc</a>: ssh to the server and execute:</p>
<pre><code class="language-bash">#display the current status
mysql -uroot -ppassword -e &quot;select username, email, resetToken, twoFactorAuthenticationSecret, twoFactorAuthenticationEnabled from box.users&quot;;

#reset the 2FA
mysql -uroot -ppassword -e &quot;UPDATE box.users set twoFactorAuthenticationEnabled=0 where username='t.test'&quot;;
</code></pre>
<p>Two factor auth reset for admin: <a href="http://forum.cloudron.io/topic/5794/how-to-reset-2fa-for-admin">http://forum.cloudron.io/topic/5794/how-to-reset-2fa-for-admin</a></p>
<h1 id="how-to-send-e-mail-via-cloudron">How to send e-mail via CloudRon</h1>
<pre><code class="language-bash">docker inspect --format '{{ .NetworkSettings.Networks.cloudron.IPAddress }}' mail #gives IP address
docker inspect --format '{{ .Config.Env }}' mail | tr ' ' '\n' | grep CLOUDRON_RELAY_TOKEN | sed 's/^.*=//' #gives token

</code></pre>
<pre><code class="language-bash">swaks -s `docker inspect --format '{{ .NetworkSettings.Networks.cloudron.IPAddress }}' mail` -p 2525 --au user@domain.com --ap `docker inspect --format '{{ .Config.Env }}' mail | tr ' ' '\n' | grep CLOUDRON_RELAY_TOKEN | sed 's/^.*=//'` -f 'user@domain.com' -t 'user@domain.com' --h-Subject &quot;Test mail&quot;
</code></pre>
<h3 id="command-line-app-install">Command line app install</h3>
<p>as per https://docs.cloudron.io/packaging/tutorial/#update</p>
<pre><code class="language-bash">npx cloudron login my.domain.com
wget https://raw.githubusercontent.com/GetZenDev/build-openfire-docker/main/CloudronManifest.json
npx cloudron install --image getzendev/openfire:latest
</code></pre>
<p>to update:</p>
<pre><code class="language-bash">export DOMAIN_NAME=mydomain.com
wget https://raw.githubusercontent.com/GetZenDev/build-openfire-docker/main/CloudronManifest.json
npx cloudron status --app $DOMAIN_NAME
npx cloudron update --image getzendev/openfire:latest --app $DOMAIN_NAME
npx cloudron status --app $DOMAIN_NAME
</code></pre>
            
          
        </div>
      </div>
    </div>
    <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
      <div class="sphinxsidebarwrapper">
        
          
            
  <h1 class="logo"><a href="../..">My KDB</a></h1>



          
            



<h3>Table Of Contents</h3>

<nav>
  
  
    <ul>
    
  </ul>
  
    <ul>
    
  </ul>
  
    <ul>
    
  </ul>
  
    <ul>
    
  </ul>
  
    <ul>
    
  </ul>
  
    <ul>
    
      <li><a href="#troubleshooting">Troubleshooting</a></li>
      <ul>
    
  </ul>
    
      <li><a href="#remove-2fa-for-admin-user">Remove 2FA for admin user</a></li>
      <ul>
    
  </ul>
    
  </ul>
  
    <ul>
    
      <li><a href="#command-line-app-install">Command line app install</a></li>
      <ul>
    
  </ul>
    
  </ul>
  

  
</nav>
          
            
  <h3>Related Topics</h3>
  <ul>
    
      <li>Previous: <a href="../Cloaked%20OpenVPN%20server%20setup/" title="previous chapter">
        Server setup
      </a></li>
    
    
      <li>Next: <a href="../CloudSigma%20API/" title="next chapter">
        CloudSigma API
      </a></li>
    
  </ul>

          
            <div id="searchbox" style="display: none;" role="search">
  <h3>Quick search</h3>
  <form class="search" action="../../search.html" method="get">
    <input name="q" type="text">
    <input value="Go" type="submit">
  </form>
  <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
  </p>
</div>
<script type="text/javascript">
  document.getElementById("searchbox").style.display = "block";
</script>
          
        
      </div>
    </div>
    <div class="clearer"></div>
  </div>

  
    <div class="footer">
      
      
        
        Powered by <a href="http://www.mkdocs.org">mkdocs 1.4.2</a>
        &amp; <a href="https://github.com/iamale/mkdocs-alabaster">mkdocs-alabaster</a>
      
    </div>
  

  <!--
  MkDocs version      : 1.4.2
  Docs Build Date UTC : 2022-11-29 15:13:35.246944+00:00
  -->
</body>
</html>